<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      #init {
        height: 800px;
        width: 100%;
        background-color: #f9f9f9;
        background-image: -moz-linear-gradient(center top, #eee, #f9f9f9, #eee);
        border: 1px solid #aaa;
        border-radius: 10px;
        box-shadow: 1px 2px 2px #ddd;
        font-family: "Cinzel", serif;
        font-weight: bold;
        font-size: 25px;
        text-align: center;
        color: #666;
        position: relative;
      }
      #btn-start {
        top: 0;
        height: 100%;
        width: 100%;
        position: absolute;
        left: -1px;
        border-radius: 10px;
        border: white 5px solid;
        text-align: center;
        background-color: lightgrey;
        color: white;
        font-family: "Cinzel", serif;
        font-weight: bolder;
        font-size: 60px;
        cursor: pointer;
      }
      #btn-start:hover {
        opacity: 0.6;
        color: black;
      }
      #game {
        margin: 5% auto;
        max-height: 800px;
        width: 1300px;
      }

      .card {
        width: 200px;
        height: 200px;
        display: inline-block;
        margin: 5px 5px;
        /* 設定子元素在 3D 空間內 */
        transform-style: preserve-3d;
        position: relative;
        transition: transform 0.5s;
      }

      .card-open {
        transform: rotateY(180deg);
      }

      .card-front {
        width: 100%;
        height: 100%;
        background-image: url(./back.png);
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        position: absolute;
        backface-visibility: hidden;
        border-radius: 10px;
        box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.2),
          inset 0 -5px 0 rgba(0, 0, 0, 0.05);
      }
      .card-front:active {
        box-shadow: 0 0 5px rgba(0, 0, 0, 1);
      }
      .card-front:hover {
        box-shadow: 0 4px 3px 0 rgba(0, 0, 0, 0.5);
        transform: translateY(-3px);
        cursor: pointer;
      }
      .card-back {
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        position: absolute;
        transform: rotateY(180deg);
        backface-visibility: hidden;
        border-radius: 5px;
      }
      img {
        object-fit: cover;
        width: 200px;
        height: 200px;
        border-radius: 5px;
      }
      #btn-start2 {
        margin: 3% 40%;
        height: 100px;
        width: auto;
        position: absolute;
        left: -1px;
        border-radius: 10px;
        border: white 5px solid;
        text-align: center;
        background-color: lightgrey;
        color: white;
        font-family: "Cinzel", serif;
        font-weight: bolder;
        font-size: 60px;
        cursor: pointer;
      }
      #btn-start2:hover {
        opacity: 0.6;
        color: black;
      }
    </style>
  </head>
  <body>
    <div id="init">
      <h1>大時代下的色彩物語：「四十八茶百鼠」</h1>
      <input type="button" id="btn-start" value="四十八茶百鼠" />
    </div>
    <div id="game"></div>
    <script src="jquery-3.5.1.min.js"></script>
    <script>
      const introductions = [
        {
          start: 1,
          text:
            " 十八世紀，進入江戶時代中期，人稱豪商的富裕階層抬頭，町人的生活也寬裕起來，人人都想穿更好的衣服、用更華麗的顏色。",
        },
        {
          start: 4,
          text:
            "為了制止這項風氣，幕府頒布了「奢侈禁止令」，嚴禁平民過奢華的生活、規定其節儉，好將多餘的金錢用於國家財政上。",
        },
        {
          start: 7,
          text:
            "於是，町人只能穿用麻或棉製成的「茶色」、「鼠色」、「藍色」衣服，華麗的色彩及花紋從平民手中被剝奪了。",
        },
        {
          start: 10,
          text:
            "但不屈不撓才是江戶人的氣魄。過去做為賤民代表色而遭到嫌棄的「茶色」與「鼠色」，以「風流瀟灑的色彩」之姿重生。",
        },
        {
          start: 13,
          text:
            "經由工匠的巧思與手藝，過去從未有過的茶色與鼠色如雨後春筍般誕生。這些新生的色彩，通稱「四十八茶百鼠」。會這麼稱呼主要是因為朗朗上口，相傳實際上誕生的顏色超過一百種。",
        },
        {
          start: 16,
          text:
            "此外，江戶時代中期也出現了許多配合語感使用借代字或略語來命名、充滿玩心的傳統色，這可以說是此一時期的趨勢。",
        },
        {
          start: 19,
          end: 22,
          text: "接著，就讓我們來認識這些富含寓意的傳統顏色吧！",
        },
        {
          start: 23,
          end: 25,
        },
      ];

      const colorCards = [
        {
          id: 1,
          text: "江戶鼠",
        },
        {
          id: 2,
          text: "柳鼠",
        },
        {
          id: 3,
          text: "桜鼠",
        },
        {
          id: 4,
          text: "素鼠",
        },
        {
          id: 5,
          text: "紺鼠",
        },
        {
          id: 6,
          text: "湊鼠",
        },
        {
          id: 7,
          text: "源氏鼠",
        },
        {
          id: 8,
          text: "葡萄鼠",
        },
        {
          id: 9,
          text: "銀鼠",
        },
      ];
      for (let introduction of introductions) {
        $("#init").append(`<p class="introduction">${introduction.text}</p>`);
      }

      // introductions fadeIn
      let timing = 0;
      let line = -1;
      const init = () => {
        timing++;
        if (introductions[line + 1].start == timing) {
          line++;
          $(".introduction").eq(line).fadeIn();
        } else if (introductions[line + 1].end == 25) {
          clearInterval(timer);
          $("#init").append(
            `<input type="button" id="btn-start2" value="LET'S GO" />`
          );
          $(".btn-start2").fadeIn();
        }
      };

      // [init] hide the introductions
      function hideintro() {
        $(".introduction").hide();
        $("#init h1").hide();
      }
      hideintro();

      //introductions
      let timer = 0;
      $("#btn-start").click(function (e) {
        $("#btn-start").fadeOut();
        $("#init h1").show();
        timer = setInterval(init, 300);
      });

      //startgame
      $("#init").on("click", "#btn-start2", function () {
        $("#init").fadeOut();
        $("#btn-start2").fadeOut();
        game();
      });

      // game
      function game() {
        $(function () {
          for (let i = 0; i < 18; i++) {
            $("#game").append(`<div class="card">
                    <div class="card-front"></div>
                    <div class="card-back"></div>
                </div>
            `);
          }

          for (let i = 0; i < $(".card").length; i++) {
            let add = (i % ($(".card").length / 2)) + 1;
            $(".card")
              .eq(i)
              .find(".card-back")
              .append(`<img src="${add}.png">`);
            $(".card").eq(i).attr("data-card", add);

            let target = Math.floor(Math.random() * $(".card").length);
            $(".card").eq(target).insertAfter($(".card").eq(i));
          }

          $("#game").on("click", ".card", function () {
            if ($(".card-open").length < 2 && !$(this).hasClass("card-open")) {
              $(this).addClass("card-open");
            }

            if ($(".card-open").length === 2) {
              setTimeout(() => {
                $(".card-open").removeClass("card-open");
              }, 800);

              // same card
              if (
                $(".card-open").eq(0).attr("data-card") ===
                $(".card-open").eq(1).attr("data-card")
              ) {
                $(".card-open").eq(0).fadeOut();
                $(".card-open").eq(1).fadeOut();
              }
            }

            if ($(".card-clear").length == $(".card").length) {
              setTimeout(() => {
                alert("finished");
              }, 500);
            }
          });
        });
      }
    </script>
  </body>
</html>
